define(["require","exports","preact/jsx-runtime","preact/hooks","preact","../../components/badgeNotification/BadgeNotification","../../components/baseSectionContainer/BaseSectionContainer","../../hooks/useFetchSectionData","../../utils/common","../../components/InputWrapperDataProvider/SelectManyWrapper","../../hooks/useDynamicFilters","../../hooks/useColorSchema","../../components/sectionBottomContext/SectionBottomContext","ojs/ojselectsingle","ojs/ojdatetimepicker"],(function(require,e,t,a,n,i,o,s,l,r,d,c,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=()=>{var e,u,v,h,g;const[p,x]=(0,a.useState)({min:"",max:""}),{filters:j,dispatchFilters:f,onFilterChangeHandler:y}=(0,d.default)({startDate:null,endDate:null}),C=(0,a.useCallback)((e=>{var t,a,n;if((null===(a=null===(t=null==e?void 0:e.context)||void 0===t?void 0:t.changeRecords)||void 0===a?void 0:a.records)&&(null===(n=e.context.changeRecords.records)||void 0===n?void 0:n.length)>0){const t=l.dateTimeConverter.parse(e.context.changeRecords.records[0].timestamp+"Z"),a=l.dateTimeConverter.parse(e.context.changeRecords.records[e.context.changeRecords.records.length-1].timestamp+"Z");x({min:t,max:a}),f({type:d.FilterActions.SET_MULTIPLE_FILTER_FIELDS,payload:[{field:"startDate",value:t},{field:"endDate",value:a}]})}}),[x,f]),{data:b,isLoading:T,error:_}=(0,s.default)("../js/jsons/insights/systemChangeJson.js",C),{getColor:D}=(0,c.default)(),S=(0,a.useMemo)((()=>{var e,t,a,n;if(!b||!(null===(t=null===(e=null==b?void 0:b.context)||void 0===e?void 0:e.changeRecords)||void 0===t?void 0:t.records))return[];let i,o;return j.startDate&&j.endDate&&(i=l.dateTimeConverter.parse(null!==(a=null==j?void 0:j.startDate)&&void 0!==a?a:""),o=l.dateTimeConverter.parse(null!==(n=null==j?void 0:j.endDate)&&void 0!==n?n:"")),b.context.changeRecords.records.filter((e=>{let t=null;i&&o&&(t=l.dateTimeConverter.parse(e.timestamp));const a=b.context.changeRecords.filters.map((t=>{var a,n;return!(j[t.fieldToFilter]&&Array.isArray(j[t.fieldToFilter])&&(null===(a=j[t.fieldToFilter])||void 0===a?void 0:a.length)>0)||((null===(n=j[t.fieldToFilter])||void 0===n?void 0:n.includes(null==e?void 0:e[t.fieldToFilter]))||!1)}));return(!i||!o||!t||l.dateTimeConverter.compareISODates(t,i)>=0&&l.dateTimeConverter.compareISODates(o,t)>=0)&&a.every(Boolean)}))}),[j]);return(0,t.jsx)(o.default,{data:b,isLoading:T,error:_,children:(0,t.jsx)("section",{children:(null==b?void 0:b.context.dataAvailability.available)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("label",{class:"systemChangeSection__filter-label oj-sm-margin-3x-bottom",children:"Filters"}),(0,t.jsxs)("div",{class:"systemChangeSection__filters oj-sm-margin-3x-bottom",children:[(0,t.jsx)("oj-input-date-time",{class:"time_filter",min:p.min,max:p.max,value:j.startDate,converter:l.dateTimeConverter,labelHint:"Start Time",autocomplete:"off",onvalueChanged:e=>y(e,"startDate")}),(0,t.jsx)("oj-input-date-time",{class:"time_filter",min:p.min,max:p.max,value:j.endDate,converter:l.dateTimeConverter,labelHint:"End Time",autocomplete:"off",onvalueChanged:e=>y(e,"endDate")}),(0,t.jsx)("div",{class:"systemChangeSection__filters-dynamic",children:null===(v=null===(u=null===(e=null==b?void 0:b.context)||void 0===e?void 0:e.changeRecords)||void 0===u?void 0:u.filters)||void 0===v?void 0:v.map(((e,a)=>(0,t.jsx)(r.default,{class:"filters-comboBox-many",dataArray:e.options,labelEdge:"inside",labelHint:e.inputLabel,arrayDataProviderOptions:{keyAttributes:"value"},value:null==j?void 0:j[e.fieldToFilter],onvalueChanged:t=>y(t,e.fieldToFilter)},a)))})]}),(0,t.jsxs)("div",{class:"systemChangeSection__changes",children:[S.map((e=>(0,t.jsxs)(n.Fragment,{children:[(0,t.jsx)("div",{class:"systemChangeSection__changeType",children:(0,t.jsx)("span",{class:"oj-badge",style:D(e.changeType),children:e.changeType})}),(0,t.jsxs)("div",{class:"oj-panel systemChangeSection__changeDescription",children:[(0,t.jsxs)("div",{class:"systemChangeSection__changeDescription-details",children:[(0,t.jsx)("span",{class:"oj-typography-body-sm oj-text-color-secondary systemChangeSection__changeDescription-timestamp",children:e.timestamp}),(0,t.jsx)("div",{class:"systemChangeSection__changeDescription-tags",children:null==e?void 0:e.tags.map(((e,a)=>(0,t.jsx)("span",{class:"oj-badge oj-badge-subtle",children:e},a)))})]}),(0,t.jsx)("p",{class:"systemChangeSection__changeDescription-paragraph",children:e.changeDescription})]})]},e.id))),0===S.length&&(0,t.jsx)(i.default,{text:"No data To Display",status:"info"})]}),(0,t.jsx)(m.default,{label:b.sectionMessage,badgeText:null!==(h=b.sectionTimeContext)&&void 0!==h?h:"No data"})]}):(0,t.jsx)(i.default,{text:null!==(g=null==b?void 0:b.context.dataAvailability.message)&&void 0!==g?g:"System Change Section Unavailable",status:null==b?void 0:b.context.dataAvailability.status})})})}}));