define(["require","exports","preact/jsx-runtime","preact/hooks","preact/compat","./osMetricsDispatch","../../../utils/common","../../../contexts/RouterContext","./osMetricsLayouts/OsMetricsSingleChart","./osMetricsLayouts/OsMetricsMultiChart","../../../utils/plotlyUtils","ojs/ojarraydataprovider","./OsMetricsTabBarRenderer","../../../components/badgeNotification/BadgeNotification","../../../contexts/MetadataContext","ojs/ojselectsingle","ojs/ojdatetimepicker","ojs/ojnavigationlist"],(function(require,e,t,o,i,s,l,n,a,r,c,d,u,m,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setTitleClassUsingStatus=void 0;e.setTitleClassUsingStatus=e=>"neutral"==e?"oj-tabbar-item-end oj-ux-icon-size-5x oj-icon-color-neutral oj-ux-ico-error-s":"danger"==e?"oj-tabbar-item-end oj-ux-icon-size-5x oj-icon-color-danger oj-ux-ico-error-s":"warning"==e?"oj-tabbar-item-end oj-ux-icon-size-5x oj-icon-color-warning oj-ux-ico-warning-s":"success"==e?"oj-tabbar-item-end oj-ux-icon-size-5x oj-icon-color-success oj-ux-ico-success-s":"info"==e?"oj-tabbar-item-end oj-ux-icon-size-5x oj-icon-color-info oj-ux-ico-error-s":void 0;e.default=(0,i.memo)((({OsMetricsId:e,data:i,sectionId:f})=>{var j,b;const x=(0,o.useContext)(v.MetaDataContext),{replaceParamsStateAndCleanParams:g}=(0,n.useParams)(),{currentSectionData:p}=(0,n.useRouter)(),S=(0,o.useMemo)((()=>{var e,t;const o=null!==(t=null===(e=null==i?void 0:i.sections)||void 0===e?void 0:e.map((e=>({id:e.sectionId,name:e.sectionTitle,status:e.status}))))&&void 0!==t?t:[];return new d(o,{keyAttributes:"id"})}),[]),[T,C]=(0,o.useState)((null===(j=null==i?void 0:i.sections)||void 0===j?void 0:j.length)>0?null==i?void 0:i.sections[0].sectionId:""),[F,h]=(0,o.useReducer)(s.osMetricsFilterDispatcher,{filters:{nodeSelected:(null===(b=null==i?void 0:i.nodes)||void 0===b?void 0:b.length)>0?"clusterwide":""},sectionFilters:{}});(0,o.useEffect)((()=>{var t,o;const i=p.params;i.subsection&&p.sectionId===f&&i.goTo===e&&(i.subsection!==T&&C(i.subsection),i.tab!==(null===(o=null===(t=F.sectionFilters)||void 0===t?void 0:t[i.subsection])||void 0===o?void 0:o.tabSelected)&&h({type:s.osMetricsFiltersActions.SET_SECTION_FILTER,payload:{sectionId:i.subsection,field:"tabSelected",value:i.tab}}))}),[p]);const I=(0,o.useCallback)(((t,o,i)=>{"tabSelected"===o?g({sectionId:t,goTo:e,subsection:t,tab:i}):h({type:s.osMetricsFiltersActions.SET_SECTION_FILTER,payload:{sectionId:t,field:o,value:i}})}),[h]),M=(0,o.useCallback)((e=>(0,c.changePlotTimeLayout)(e,F.filters.startDate,F.filters.endDate)),[F.filters]),y=(0,o.useCallback)((e=>{let t=e;t=(0,c.changePlotTimeLayout)(e,F.filters.startDate,F.filters.endDate);const o=[];return F.filters.nodeSelected&&"clusterwide"!==F.filters.nodeSelected?o.push(F.filters.nodeSelected):i.nodes.forEach((e=>"clusterwide"!==e.value&&o.push(e.value))),t=(0,c.selectPlotLegends)(e,o),t}),[F.filters]),D=(0,o.useMemo)((()=>{if(!i)return null;return i.sections.find((e=>e.sectionId===T))}),[T]),E=(0,o.useMemo)((()=>{var e;return new d(null!==(e=null==i?void 0:i.nodes)&&void 0!==e?e:[],{keyAttributes:"value"})}),[]),_=(e,t)=>{const o=e.detail.value;h({type:s.osMetricsFiltersActions.SET_FILTER,payload:{field:t,value:o}})},P=(0,o.useCallback)((e=>{const[t,o]=(0,c.onPlotTimeRangeSelectionHandler)(e);F.filters.startDate===t&&F.filters.endDate===o||h({type:s.osMetricsFiltersActions.SET_MULTIPLE_FILTER_FIELDS,payload:[{field:"startDate",value:t},{field:"endDate",value:o}]})}),[h]);return(0,t.jsxs)("section",{children:[(0,t.jsxs)("div",{class:"osMetrics__filters",children:[(0,t.jsx)("oj-input-date-time",{class:"time_filter",min:null==x?void 0:x.timePeriod.fromTimeIsoString,max:null==x?void 0:x.timePeriod.toTimeIsoString,value:F.filters.startDate,converter:l.dateTimeConverter,labelHint:"Start Time",autocomplete:"off",onvalueChanged:e=>_(e,"startDate")}),(0,t.jsx)("oj-input-date-time",{class:"time_filter",min:null==x?void 0:x.timePeriod.fromTimeIsoString,max:null==x?void 0:x.timePeriod.toTimeIsoString,value:F.filters.endDate,converter:l.dateTimeConverter,labelHint:"End Time",autocomplete:"off",onvalueChanged:e=>_(e,"endDate")}),(0,t.jsx)("oj-select-single",{labelHint:"Select Node",labelEdge:"inside",class:"oj-form-control-max-width-md osMetrics__select-node",data:E,value:F.filters.nodeSelected,onvalueChanged:e=>_(e,"nodeSelected")})]}),(0,t.jsx)("oj-tab-bar",{edge:"top",selection:T,class:"oj-sm-margin-2x-bottom",onselectionChanged:t=>{if("external"===t.detail.updatedFrom)return;const o=t.detail.value;o&&g({sectionId:f,goTo:e,subsection:o})},data:S,children:(0,t.jsx)("template",{slot:"itemTemplate",render:u.default})}),D&&"singleChart"===D.context.layout&&(0,t.jsx)(a.default,{sectionData:D,filters:F,setSubsectionFilter:I,onRelayoutPlotHandler:P,noClusterWideFilterFunction:M,clusterWideFilterFunction:y}),D&&"multiChart"===D.context.layout&&(0,t.jsx)(r.default,{sectionData:D,filters:F,setSubsectionFilter:I,onRelayoutPlotHandler:P,noClusterWideFilterFunction:M,clusterWideFilterFunction:y}),!D&&(0,t.jsx)(m.default,{text:"No section Available",status:"info"})]})}))}));