define(["require","exports","preact/jsx-runtime","preact/hooks","./bestPracticeIssuesFilterFunctions","../../components/loadingScreen/LoadingScreen","../../components/badgeNotification/BadgeNotification","../../hooks/useFetchSectionData","./BestPracticeIssuesNonCheckSection","../../utils/plotlyUtils","./BestPracticeIssuesFilters","./BestPracticeIssuesSummarySection","./BestPracticeIssuesMessages","./BestPracticeIssuesSettingsDialog","./BestPracticeIssuesSectionCheck","../../components/plotlyContainer/PlotlyContainer","../../hooks/useDynamicFilters","ojs/ojarraydataprovider","ojs/ojaccordion"],(function(require,e,t,s,a,n,o,c,i,l,r,u,d,h,p,v,x,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const f=e=>{const t=e=>e.sectionId;return e.context.sections.map(t).concat(e.context.nonCheckSections.map(t))};e.default=()=>{var e;const m=(0,s.useCallback)((e=>{const t=[];for(const s of e.context.statusOptions)"PASS"!==s.value&&"INFO"!==s.value&&t.push(s.value);const s=f(e);C({type:x.FilterActions.SET_MULTIPLE_FILTER_FIELDS,payload:[{field:"status",value:t},{field:"visibleSections",value:s}]})}),[]),{isLoading:I,data:b,error:j}=(0,c.default)("../js/jsons/insights/bestPracticeIssuesJson.js",m),{filters:g,dispatchFilters:C,onFilterChangeHandler:P}=(0,x.default)({searchCriteria:"checkName",search:"",jumpToSection:"",status:[]}),[_,k]=(0,s.useState)(!1),[F,y]=(0,s.useState)(!1),L=(0,s.useMemo)((()=>{var e,t;if(!b)return new S([]);const s=e=>({label:e.sectionName,value:e.sectionId}),a=null===(e=null==b?void 0:b.context)||void 0===e?void 0:e.sections.map(s),n=null===(t=null==b?void 0:b.context)||void 0===t?void 0:t.nonCheckSections.map(s);return new S([...a,...n],{keyAttributes:"value"})}),[b]),E=(0,s.useMemo)((()=>b?f(b):[]),[b]),A=(0,s.useMemo)((()=>{var e;const t={};return null===(e=g.visibleSections)||void 0===e||e.forEach((e=>{t[e]=!0})),t}),[g.visibleSections]),N=(0,s.useCallback)((e=>{var t;return(0,l.selectPlotLegends)(e,null!==(t=null==g?void 0:g.status)&&void 0!==t?t:[])}),[g.status]),D=(0,s.useCallback)(((e,t)=>{const s=(0,l.getLegendsCurrentlySelectedFromPlot)(e,t);C({type:x.FilterActions.SET_DYNAMIC_FILTER_FIELD,payload:{fieldName:"status",value:s}})}),[C]),M=(0,s.useMemo)((()=>{if(!b)return[];const e=g.searchCriteria,t=g.search,s=g.status;if(!(e||t||s&&0!==s.length))return b.context.sections;const n=b.context.sections.map((n=>Object.assign(Object.assign({},n),{subsection:n.subsection.map((n=>Object.assign(Object.assign({},n),{checksList:n.checksList.filter((n=>{var o,c;return(!(s&&s.length>0)||s.includes(n.checkStatus))&&(null!==(c=null===(o=a.bestPracticeIssuesSearchCriteriaFilterFunctions[e])||void 0===o?void 0:o.filterFunction(n,null!=t?t:""))&&void 0!==c?c:()=>!0)}))})))})));return n}),[g.search,g.searchCriteria,g.status,b]),T=(0,s.useCallback)((()=>{b&&C({type:x.FilterActions.SET_DYNAMIC_FILTER_FIELD,payload:{fieldName:"visibleSections",value:E}})}),[b,C]);return j?(0,t.jsx)(o.default,{text:j,status:"danger"}):I||!b&&!j?(0,t.jsx)(n.default,{}):b&&b.available?(0,t.jsxs)("section",{class:"bestPracticeIssues__container",children:[(0,t.jsx)(h.default,{onFilterChangeHandler:P,visibleSections:null!==(e=g.visibleSections)&&void 0!==e?e:[],allSectionsDataProvider:L,onSelectAllVisibleSections:T,allSectionsIds:E,setShowCheckIds:y,showCheckIds:F,expandAll:_,setExpandAll:k}),(0,t.jsx)(u.default,{programName:b.context.programName,summarySectionData:b.context.clusterSummary}),(0,t.jsx)(d.default,{messages:b.context.alertMessages}),(0,t.jsxs)("div",{class:"bestPracticeIssues__plots__container",children:[(0,t.jsx)(v.default,{plotPath:b.context.plots[1].report,class:"bestPracticeIssues__plots-health"}),(0,t.jsx)(v.default,{filterFunction:N,plotPath:b.context.plots[0].report,onRestyle:D,class:"bestPracticeIssues__plots-bar"})]}),(0,t.jsx)(r.default,{data:b,dispatchFilters:C,filters:g,allSectionsDataProvider:L}),M.map((e=>(null==A?void 0:A[e.sectionId])&&(0,t.jsx)(p.default,{expandAll:_,showCheckIds:F,expanded:_,section:e},e.sectionId))),b.context.nonCheckSections&&b.context.nonCheckSections.length>0&&(0,t.jsx)("div",{class:"bestPracticeIssues__separator",children:(0,t.jsxs)("h3",{class:"bestPracticeIssues__separator-heading oj-typography-title-6",children:[(0,t.jsx)("span",{class:"oj-ux-ico-flagged-s"}),(0,t.jsx)("span",{children:"End of Check Sections"})]})}),b.context.nonCheckSections.map((e=>(null==A?void 0:A[e.sectionId])&&(0,t.jsx)(i.default,{expandAll:_,nonCheckSection:e})))]}):(0,t.jsx)(o.default,{text:"Section Unavailable",status:"info"})}}));