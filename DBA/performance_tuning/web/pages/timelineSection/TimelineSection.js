define(["require","exports","preact/jsx-runtime","preact/hooks","../../components/badgeNotification/BadgeNotification","../../components/copyButton/CopyButton","ojs/ojarraydataprovider","../../components/plotlyContainer/PlotlyContainer","../../utils/common","./TimelineTableRowRenderer","../../components/InputWrapperDataProvider/SelectManyWrapper","../../components/table/Table","../../utils/plotlyUtils","../../hooks/useDynamicFilters","../../hooks/useFetchSectionData","../../components/baseSectionContainer/BaseSectionContainer","ojs/ojselectsingle","ojs/ojdatetimepicker","ojs/ojinputtext"],(function(require,e,t,l,n,a,i,o,d,r,s,u,v,c,m,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=()=>{var e,h,b,x,f,j,T,g,C,y;const[D,_]=(0,l.useState)(null),{filters:S,dispatchFilters:L,onFilterChangeHandler:I}=(0,c.default)({startDate:"",endDate:""}),F=(0,l.useCallback)((e=>{var t,l,n,a;_((null===(l=null===(t=null==e?void 0:e.context)||void 0===t?void 0:t.timelines)||void 0===l?void 0:l.length)>0?null===(a=null===(n=null==e?void 0:e.context)||void 0===n?void 0:n.timelines[0])||void 0===a?void 0:a.plot:{available:!1,height:0,report:""}),e.context.table.records.length>0&&L({type:c.FilterActions.SET_MULTIPLE_FILTER_FIELDS,payload:[{field:"startDate",value:e.context.table.records[0].attr.eventTime},{field:"endDate",value:e.context.table.records[e.context.table.records.length-1].attr.eventTime}]})}),[_,L]),{data:w,error:E,isLoading:P}=(0,m.default)("../js/jsons/insights/eventsJson",F),k=(0,l.useMemo)((()=>{var e,t;return new i(null!==(t=null===(e=null==w?void 0:w.context)||void 0===e?void 0:e.timelines)&&void 0!==t?t:[],{keyAttributes:"plot"})}),[w]),A=(0,l.useMemo)((()=>{if(!w)return{min:"",max:""};const e=null==w?void 0:w.context.table.records;return(null==e?void 0:e.length)>0?{min:d.dateTimeConverter.parse(e[0].attr.eventTime),max:d.dateTimeConverter.parse(e[w.context.table.records.length-1].attr.eventTime)}:{min:"",max:""}}),[w]),N=(0,l.useRef)(null),R=(0,l.useCallback)((e=>{var t,l;let n,a;return(null==S?void 0:S.startDate)&&(null==S?void 0:S.endDate)&&(n=null!==(t=d.dateTimeConverter.parse(S.startDate))&&void 0!==t?t:"",a=null!==(l=d.dateTimeConverter.parse(S.endDate))&&void 0!==l?l:""),e.filter((e=>{var t,l,i,o,r,s,u,v,c,m,p;let h;return S.startDate&&S.endDate&&(h=null!==(t=d.dateTimeConverter.parse(e.attr.eventTime))&&void 0!==t?t:""),(!(null==S?void 0:S.eventComponent)||0===(null===(l=null==S?void 0:S.eventComponent)||void 0===l?void 0:l.length)||S.eventComponent.includes(null===(i=null==e?void 0:e.children[0])||void 0===i?void 0:i.eventComponent))&&(!(null==S?void 0:S.database)||0===(null===(o=null==S?void 0:S.database)||void 0===o?void 0:o.length)||S.database.includes(null==e?void 0:e.children[0].eventDatabase))&&(!(null==S?void 0:S.instance)||0===(null===(r=null==S?void 0:S.instance)||void 0===r?void 0:r.length)||S.instance.includes(null==e?void 0:e.children[0].eventInstance))&&(!(null==S?void 0:S.eventName)||0===(null===(s=null==S?void 0:S.eventName)||void 0===s?void 0:s.length)||S.eventName.includes(null===(u=null==e?void 0:e.attr)||void 0===u?void 0:u.eventName))&&(!(null==S?void 0:S.hostname)||0===(null===(v=null==S?void 0:S.hostname)||void 0===v?void 0:v.length)||S.hostname.includes(null===(c=null==e?void 0:e.attr)||void 0===c?void 0:c.hostname))&&(!(null==S?void 0:S.eventType)||0===(null===(m=null==S?void 0:S.eventType)||void 0===m?void 0:m.length)||S.eventType.includes(null===(p=null==e?void 0:e.attr)||void 0===p?void 0:p.eventType))&&(!n||!a||!h||d.dateTimeConverter.compareISODates(h,n)>=0&&d.dateTimeConverter.compareISODates(a,h)>=0)&&(!(null==S?void 0:S.searchInput)||(null==e?void 0:e.attr.eventTime.toLowerCase().includes(S.searchInput))||(null==e?void 0:e.attr.eventType.toLowerCase().includes(S.searchInput))||(null==e?void 0:e.attr.eventName.toLowerCase().includes(S.searchInput))||(null==e?void 0:e.attr.hostname.toLowerCase().includes(S.searchInput))||(null==e?void 0:e.attr.eventString.toLowerCase().includes(S.searchInput)))}))}),[S]),H=(0,l.useCallback)((e=>(0,v.changePlotTimeLayout)(e,S.startDate,S.endDate)),[S.startDate,S.endDate]);return(0,t.jsx)(p.default,{data:w,error:E,isLoading:P,children:(0,t.jsx)("section",{children:(null==w?void 0:w.available)&&(null===(h=null===(e=null==w?void 0:w.context)||void 0===e?void 0:e.dataAvailability)||void 0===h?void 0:h.available)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{class:"oj-flex oj-sm-justify-content-flex-end",children:(0,t.jsx)("oj-select-single",{class:"timelineSection__plots-dropdown",labelHint:"Select timeline",data:k,value:D,onvalueChanged:e=>{e.detail.value&&_(e.detail.value)}})}),(null==D?void 0:D.available)&&(0,t.jsx)(o.default,{plotPath:D.report,onRelayout:e=>{const[t,l]=(0,v.onPlotTimeRangeSelectionHandler)(e);S.startDate===t&&S.endDate===l||L({type:c.FilterActions.SET_MULTIPLE_FILTER_FIELDS,payload:[{field:"startDate",value:t},{field:"endDate",value:l}]})},filterFunction:H}),!(null==D?void 0:D.available)&&(0,t.jsx)(n.default,{text:"Plot not available",status:"info"}),(0,t.jsx)("label",{class:"oj-sm-margin-3x-bottom timelineSection__filters-label",children:"Filters"}),(0,t.jsxs)("div",{class:"timelineSection__filters__container",children:[(0,t.jsx)("oj-input-date-time",{class:"time_filter",min:A.min,max:A.max,value:S.startDate,converter:d.dateTimeConverter,labelHint:"Start Time",autocomplete:"off",onvalueChanged:e=>I(e,"startDate")}),(0,t.jsx)("oj-input-date-time",{class:"time_filter",min:A.min,max:A.max,value:S.endDate,converter:d.dateTimeConverter,labelHint:"End Time",autocomplete:"off",onvalueChanged:e=>I(e,"endDate")}),(0,t.jsx)("oj-input-text",{labelEdge:"inside",class:"filters-comboBox-many timelineSection__inputSearch",labelHint:"Search",placeholder:"Search",value:S.searchInput,onvalueChanged:e=>I(e,"searchInput")})]}),(0,t.jsxs)("div",{class:"timelineSection__filters__container",children:[null===(x=null===(b=null==w?void 0:w.context)||void 0===b?void 0:b.table)||void 0===x?void 0:x.filters.map((e=>(0,t.jsx)(s.default,{class:"filters-comboBox-many",labelHint:e.inputLabel,labelEdge:"inside",dataArray:e.options,"aria-label":e.inputLabel,arrayDataProviderOptions:{keyAttributes:"value"},value:S[e.fieldToFilter],onvalueChanged:t=>I(t,e.fieldToFilter)}))),(0,t.jsx)(a.default,{getText:()=>{var e,t;return null!==(t=null===(e=N.current)||void 0===e?void 0:e.getCurrentData())&&void 0!==t?t:""},tableFormat:{maxLength:1e3,wrapColumns:!1,delimeterColumn:" ",delimeterRow:""},class:"timelineSection__copy-btn"})]}),(0,t.jsx)(u.default,{ref:N,dataArray:w.context.table.records,columns:w.context.table.columns,scrollPolicy:"loadMoreOnScroll",id:"timelineVisualizationNestedTable",columnsDefault:{sortable:"disabled"},class:"timelineSection__table",rowExpander:!0,filterFunction:R,children:(0,t.jsx)("template",{slot:"rowTemplate",render:r.default})})]}):(0,t.jsx)(n.default,{text:null!==(T=null===(j=null===(f=null==w?void 0:w.context)||void 0===f?void 0:f.dataAvailability)||void 0===j?void 0:j.message)&&void 0!==T?T:"Section Unavailable",status:null!==(y=null===(C=null===(g=null==w?void 0:w.context)||void 0===g?void 0:g.dataAvailability)||void 0===C?void 0:C.status)&&void 0!==y?y:"info"})})})}}));